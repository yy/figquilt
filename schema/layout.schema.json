{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/yy/figquilt/main/schema/layout.schema.json",
  "$defs": {
    "LabelStyle": {
      "description": "Styling options for panel labels.",
      "properties": {
        "enabled": {
          "default": true,
          "description": "Whether to show labels",
          "title": "Enabled",
          "type": "boolean"
        },
        "auto_sequence": {
          "default": true,
          "description": "Auto-generate labels A, B, C...",
          "title": "Auto Sequence",
          "type": "boolean"
        },
        "font_family": {
          "default": "Helvetica",
          "description": "Font family for labels",
          "title": "Font Family",
          "type": "string"
        },
        "font_size_pt": {
          "default": 8.0,
          "description": "Font size in points",
          "exclusiveMinimum": 0,
          "title": "Font Size Pt",
          "type": "number"
        },
        "offset_x": {
          "default": 2.0,
          "description": "Horizontal offset from panel edge (in page units)",
          "title": "Offset X",
          "type": "number"
        },
        "offset_y": {
          "default": 2.0,
          "description": "Vertical offset from panel edge (in page units)",
          "title": "Offset Y",
          "type": "number"
        },
        "bold": {
          "default": true,
          "description": "Use bold font",
          "title": "Bold",
          "type": "boolean"
        },
        "uppercase": {
          "default": true,
          "description": "Use uppercase letters",
          "title": "Uppercase",
          "type": "boolean"
        }
      },
      "title": "LabelStyle",
      "type": "object"
    },
    "LayoutNode": {
      "description": "A node in the layout tree - either a container or a leaf panel.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "enum": [
                "row",
                "col",
                "auto"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Container type: row (horizontal), col (vertical), or auto",
          "title": "Type"
        },
        "children": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/LayoutNode"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Child nodes (containers or leaves)",
          "title": "Children"
        },
        "ratios": {
          "anyOf": [
            {
              "items": {
                "type": "number"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Relative sizing of children (e.g., [3, 2] = 60%/40%)",
          "title": "Ratios"
        },
        "gap": {
          "default": 0.0,
          "description": "Gap between children (in page units)",
          "minimum": 0,
          "title": "Gap",
          "type": "number"
        },
        "margin": {
          "default": 0.0,
          "description": "Inner margin of this container",
          "minimum": 0,
          "title": "Margin",
          "type": "number"
        },
        "auto_mode": {
          "default": "best",
          "description": "Auto-layout bias preset",
          "enum": [
            "best",
            "one-column",
            "two-column"
          ],
          "title": "Auto Mode",
          "type": "string"
        },
        "size_uniformity": {
          "default": 0.6,
          "description": "How strongly to favor similar panel sizes",
          "maximum": 1,
          "minimum": 0,
          "title": "Size Uniformity",
          "type": "number"
        },
        "main_scale": {
          "default": 2.0,
          "description": "Size weight for leaves with role='main'",
          "exclusiveMinimum": 0,
          "title": "Main Scale",
          "type": "number"
        },
        "id": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Unique identifier for this panel",
          "title": "Id"
        },
        "file": {
          "anyOf": [
            {
              "format": "path",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Path to source file (PDF, SVG, or PNG)",
          "title": "File"
        },
        "fit": {
          "default": "contain",
          "description": "How to fit the figure in its cell",
          "enum": [
            "contain",
            "cover"
          ],
          "title": "Fit",
          "type": "string"
        },
        "align": {
          "default": "center",
          "description": "How to align content within cell when using contain fit",
          "enum": [
            "center",
            "top",
            "bottom",
            "left",
            "right",
            "top-left",
            "top-right",
            "bottom-left",
            "bottom-right"
          ],
          "title": "Align",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override the auto-generated label text",
          "title": "Label"
        },
        "label_style": {
          "anyOf": [
            {
              "$ref": "#/$defs/LabelStyle"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override default label styling for this panel"
        },
        "role": {
          "default": "normal",
          "description": "Optional prominence role for auto layout",
          "enum": [
            "normal",
            "main"
          ],
          "title": "Role",
          "type": "string"
        },
        "weight": {
          "anyOf": [
            {
              "exclusiveMinimum": 0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional explicit size weight for auto layout",
          "title": "Weight"
        }
      },
      "title": "LayoutNode",
      "type": "object"
    },
    "Page": {
      "description": "Page dimensions and default settings.",
      "properties": {
        "width": {
          "description": "Page width (in specified units)",
          "exclusiveMinimum": 0,
          "title": "Width",
          "type": "number"
        },
        "height": {
          "description": "Page height (in specified units)",
          "exclusiveMinimum": 0,
          "title": "Height",
          "type": "number"
        },
        "units": {
          "default": "mm",
          "description": "Units for dimensions",
          "enum": [
            "mm",
            "inches",
            "pt"
          ],
          "title": "Units",
          "type": "string"
        },
        "dpi": {
          "default": 300,
          "description": "Resolution for rasterized output",
          "minimum": 1,
          "title": "Dpi",
          "type": "integer"
        },
        "background": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": "white",
          "description": "Background color (name or hex)",
          "title": "Background"
        },
        "margin": {
          "default": 0.0,
          "description": "Page margin; panel coordinates are offset by this",
          "minimum": 0,
          "title": "Margin",
          "type": "number"
        },
        "auto_scale": {
          "default": false,
          "description": "Auto-fit oversized explicit panel layouts to the page content area",
          "title": "Auto Scale",
          "type": "boolean"
        },
        "label": {
          "$ref": "#/$defs/LabelStyle",
          "description": "Default label style"
        }
      },
      "required": [
        "width",
        "height"
      ],
      "title": "Page",
      "type": "object"
    },
    "Panel": {
      "description": "A figure panel to place on the page (with explicit coordinates).",
      "properties": {
        "id": {
          "description": "Unique identifier for this panel",
          "title": "Id",
          "type": "string"
        },
        "file": {
          "description": "Path to source file (PDF, SVG, or PNG)",
          "format": "path",
          "title": "File",
          "type": "string"
        },
        "x": {
          "description": "X position from left edge (in page units)",
          "title": "X",
          "type": "number"
        },
        "y": {
          "description": "Y position from top edge (in page units)",
          "title": "Y",
          "type": "number"
        },
        "width": {
          "description": "Panel width (in page units)",
          "exclusiveMinimum": 0,
          "title": "Width",
          "type": "number"
        },
        "height": {
          "anyOf": [
            {
              "exclusiveMinimum": 0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Panel height; if omitted, computed from aspect ratio",
          "title": "Height"
        },
        "fit": {
          "default": "contain",
          "description": "How to fit the figure: contain (preserve aspect) or cover (fill and clip)",
          "enum": [
            "contain",
            "cover"
          ],
          "title": "Fit",
          "type": "string"
        },
        "align": {
          "default": "center",
          "description": "How to align content within cell when using contain fit mode",
          "enum": [
            "center",
            "top",
            "bottom",
            "left",
            "right",
            "top-left",
            "top-right",
            "bottom-left",
            "bottom-right"
          ],
          "title": "Align",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override the auto-generated label text",
          "title": "Label"
        },
        "label_style": {
          "anyOf": [
            {
              "$ref": "#/$defs/LabelStyle"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override default label styling for this panel"
        }
      },
      "required": [
        "id",
        "file",
        "x",
        "y",
        "width"
      ],
      "title": "Panel",
      "type": "object"
    }
  },
  "description": "Root layout object for figquilt.",
  "properties": {
    "page": {
      "$ref": "#/$defs/Page",
      "description": "Page dimensions and settings"
    },
    "panels": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/Panel"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "List of panels with explicit coordinates (legacy mode)",
      "title": "Panels"
    },
    "layout": {
      "anyOf": [
        {
          "$ref": "#/$defs/LayoutNode"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Root layout node for grid-based layout"
    }
  },
  "required": [
    "page"
  ],
  "title": "Layout",
  "type": "object"
}
